#+title: leaf.elを使う - Emacs初心者のためのEmacs拡張入門
#+author: conao3

* 背景
先日MELPAにleaf.elがマージされ、導入のコストが最小限になりました。
  - [[https://qiita.com/conao3/items/dc88bdadb0523ef95878][{正式リリース}leaf.elで雑然としたEmacs設定ファイル「init.el」をクリーンにする]]

その折にQiitaで紹介記事を書いたのですが、実際どの様に使えばいいのか、そもそもEmacsにパッケージをどの様にインストールすればよいのか、
そういう視点での補足記事が必要であろうと思ったので、この記事を書く次第です。

なお、この記事では簡潔さを重視して、説明を省く箇所があることをご了承下さい。
省くのは歴史的な経緯によって、互換性のために残されている機能で、現代では使用されないものです。

例えば、ホームディレクトリに ~.emacs~ という「ファイル」を置く方法と、
~.emacs.d~ という「ディレクトリ」を置いて、その中に ~init.el~ というファイルを置く方法がありますが、
現代ではほとんど後者のみが用いられているため、前者に関する説明は省略します。

* Emacsのインストール
Emacsのインストールは各々の環境とEmacsに何を求めるかによって、いろいろな方法があり、Emacs-JPでも「標準インストール」という手順を定められずにいます。

ひとまず、ここでは一つの方法を示すので、またコミュニティの共通認識が出てくれば変更することにします。

** Mac
私は現在パッチなし、標準ローカルビルドのEmacs-26.2を使用していますが、やはり ~brew~ で導入できるのは簡便さの面で大きなメリットがあります。
複数バージョンをローカルに持っておかないといけないといった珍しい状況を除けば、 ~brew~ を選択するのは十分合理的だと思います。

#+begin_src bash
  brew tap railwaycat/emacsmacport
  brew install emacs-mac
#+end_src

** Ubuntu
環境がないので分かりませんが、ローカルビルドしても大きな手間ではないと思います。
~apt~ で入れる場合はデフォルトではバージョンが古いため、アーカイブサイトを追加した後にインストールする必要があります。
  - http://ubuntuhandbook.org/index.php/2019/04/gnu-emacs-26-2-released-install-in-ubuntu-18-04/

#+begin_src bash
  sudo add-apt-repository ppa:kelleyk/emacs
  sudo apt update
  sudo apt install emacs26
#+end_src

** Windows
環境がないので全く分かりません。私が高校の時はgnupackのdevelを使っていましたが、MSYS2の方が良いという情報もあり、良く分かりません。
  - https://ja.osdn.net/projects/gnupack/
  - https://www.msys2.org/
  
* 必要最低限のEmacs知識
** 画面の要素
Emacsでの「ウィンドウ」は一般的な意味での「ウィンドウ」とは意味が異なっており、誤解していると意味を取り違えてしまいます。

さらに「ポイント」は一般的な用語での「カーソル」です。「ポイント」の直前に文字が挿入されます。
[[./img/106A8907-3CC1-456B-80DF-650D38743F0C-2.png]]

** ショートカットキー
歴史的な経緯により ~Alt~ キーを ~Meta~ と呼びます。

さらに修飾キーの一文字を取って ~Ctrl~, ~Shift~, ~Meta~ を ~C~, ~S~, ~M~ と表記します。
つまり ~M-S-5 (query-replace)~ は ~Meta(Alt)~ キーと ~Shift~ を押しながら ~5~ を押すことを示します。
また ~S-5~ は ~%~ と等価なので、 ~M-% (query-replace)~ と表現することがあります。

なお、2つのコンビネーションを続けて書いた場合は、続けてそれらのキーを押すことになります。
つまり ~C-x C-f (find-file)~ は ~Ctrl~ と ~x~ を押した後に、 ~Ctrl~ と ~f~ を押すことを示しています。

** Emacsの起動と終了
ターミナルを開き、 ~emacs~ と打つことでEmacsが起動します。

初期化ファイルなしで起動するには ~emacs -q~, デバッグ情報を表示するには ~emacs --debug-init~ で起動します。

~C-x C-c (save-buffers-kill-terminal)~ 
** 困ったら
とりあえず ~C-g (keyboard-quit)~ を連打します。これは今の作業を中断して、通常の入力状態に戻すことを意味します。
「あれ？」っと思ったら、すぐに ~C-g~ を何回かタイプすることを覚えておくといいと思います。

さらに、ユーザーが普段使うコマンドはショートカットを覚えていなくても、 ~M-x~ を実行することでコマンドの名前を検索して実行できます。

* 初期化ファイルの作成
MacやLinuxならホームディレクトリの場所は疑いようがありませんが、Windowsの場合、選んだ処理系によってホームディレクトリが違うので注意する必要があります。

~C-x C-f (find-file)~ をした後にミニバッファで「Find file: 」とプロンプトが出るので、
